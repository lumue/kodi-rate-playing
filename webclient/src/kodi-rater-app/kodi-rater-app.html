<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../bower_components/sse-client/sse-client.html">
<link rel="import" href="rate-item-view.html">

<dom-module id="kodi-rater-app">
  <template>
    <style>
      :host {
        display: block;
      }
    </style>
    <sse-client id="eventSource" url="[[apiUrl]]/events" on-message="_handleEvent"></sse-client>
    <rate-item-view movie="{{currentMovie}}"></rate-item-view>
  </template>

  <script>/**
   * @customElement
   * @polymer
   */
  class KodiRaterApp extends Polymer.Element {
	  static get is() {
		  return 'kodi-rater-app';
	  }

	  static get properties() {
		  return {
			  currentMovie: {
				  type: Object,
				  value: null,
                  notify: true
			  },
			  apiUrl: {
				  type: String,
				  value: function (){
				  	const localStorageItem=localStorage.getItem("apiUrl")
					  if(localStorageItem.isUndefined)
					  	return ""
					  return localStorageItem
				  },
				  notify: true
			  }
		  };
	  }

	  connectedCallback() {
		  super.connectedCallback()
		  this.$.eventSource.connect()
	  }

	  disconnectedCallback() {
		  super.disconnectedCallback()
		  this.$.eventSource.close()
	  }

	  _handleEvent(data) {
		  this.currentMovie=data.detail;
	  }
  }

  window.customElements.define(KodiRaterApp.is, KodiRaterApp);</script>
</dom-module>
